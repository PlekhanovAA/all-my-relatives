<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title th:text="#{nav.gallery}">–ì–∞–ª–µ—Ä–µ—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet"/>

    <meta th:name="_csrf" th:content="${_csrf.token}"/>
    <meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<body th:data-username="${#authentication.name}"
      th:data-is-admin="${#authorization.expression('hasRole(''ADMIN'')')}">

<!-- üîó –ù–∞–≤–±–∞—Ä -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container text-center mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0" th:text="#{gallery.title}">–§–æ—Ç–æ–∞–ª—å–±–æ–º</h2>
        <div>
            <!-- –ö–Ω–æ–ø–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN -->
            <button th:if="${#authorization.expression('hasRole(''ADMIN'')')}"
                    id="toggleEditMode"
                    class="btn btn-warning">
                ‚úèÔ∏è <span th:text="#{gallery.editMode}">–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
            </button>

            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
            <a href="/gallery/grid" class="btn btn-outline-secondary" th:title="#{gallery.settings}">
                <i class="bi bi-gear-fill"></i>
            </a>
        </div>
    </div>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ + —Å–ª–æ–π –¥–ª—è —Ç–µ–≥–æ–≤ -->
    <div class="d-flex align-items-center justify-content-center position-relative">
        <button class="btn btn-outline-secondary position-absolute start-0" onclick="showPrevious()">
            <i class="bi bi-chevron-left"></i>
        </button>

        <div id="photoCanvas" class="position-relative d-inline-block">
            <img id="mainPhoto" src="" alt="–§–æ—Ç–æ" class="img-fluid rounded shadow"
                 style="max-height: 400px; max-width: 100%;"/>
        </div>

        <button class="btn btn-outline-secondary position-absolute end-0" onclick="showNext()">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>

    <!-- üßë‚Äçü§ù‚Äçüßë –°–ø–∏—Å–æ–∫ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ -->
    <div id="taggedRelatives" class="mt-4 text-start">
        <h5 th:text="#{gallery.taggedRelatives}">–ù–∞ —Ñ–æ—Ç–æ –æ—Ç–º–µ—á–µ–Ω—ã:</h5>
        <ul id="relativesList" class="list-unstyled ps-3"></ul>
    </div>
</div>

<!-- üìå –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN) -->
<div th:if="${#authorization.expression('hasRole(''ADMIN'')')}"
     th:replace="~{fragments/relative_tag_modal :: tagModal}"></div>

<!-- –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JS -->
<script th:inline="javascript">
    window.galleryData = {
        galleryOwner: [[${galleryOwner}]],
        photos: [[${photos}]],
        noPhotosMsg: [[#{gallery.noPhotos}]],
        isAdmin: [[${#authorization.expression('hasRole(''ADMIN'')')}]]
    };
</script>
<script>console.log("galleryData:", window.galleryData);</script>
<script th:src="@{/js/gallery.js}"></script>
<script th:src="@{/js/gallery_tags.js}"></script> <!-- –ø–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ–≥–¥–∞ -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
