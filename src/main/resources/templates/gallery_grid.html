<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–ì–∞–ª–µ—Ä–µ—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet" />
</head>
<body data-username="[[${#authentication.name}]]">


<div sec:authorize="isAuthenticated()"
     th:replace="~{fragments/navbar :: navbar}">
</div>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0" th:text="#{nav.gallery}">–ì–∞–ª–µ—Ä–µ—è</h2>
        <div>
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É) -->
            <button class="btn btn-outline-success me-2" data-bs-toggle="modal" data-bs-target="#uploadModal"
                    sec:authorize="hasRole('ADMIN')">
                <i class="bi bi-upload"></i>
            </button>

            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
            <a href="/gallery" class="btn btn-outline-secondary" title="–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É">
                <i class="bi bi-arrow-left"></i>
            </a>
        </div>
    </div>

    <!-- üìã –¢–∞–±–ª–∏—Ü–∞ —Å —Ñ–æ—Ç–æ -->
    <table class="table table-hover align-middle">
        <thead class="table-light">
        <tr>
            <th th:text="#{gallery.grid.photo}">–§–æ—Ç–æ</th>
            <th th:text="#{gallery.filename}">–ò–º—è —Ñ–∞–π–ª–∞</th>
            <th class="text-end" th:text="#{gallery.actions}">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="photo : ${photos}">
            <td style="width: 72px;">
                <img th:src="@{'/uploads/' + ${#authentication.name} + '/gallery/' + ${photo}}"
                     alt="thumb"
                     class="img-thumbnail"
                     style="width: 64px; height: 64px; object-fit: cover;">
            </td>
            <td th:text="${photo}"></td>
            <td class="text-end">
                <button type="button"
                        class="btn btn-sm text-danger border-0 bg-transparent"
                        th:attr="data-filename=${photo}"
                        onclick="confirmDeleteFromButton(this)"
                        title="#{button.delete}"
                        sec:authorize="hasRole('ADMIN')">
                    <i class="bi bi-trash3-fill fs-5"></i>
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <div class="mt-4">
        <h5 th:text="#{filters.title}">–§–∏–ª—å—Ç—Ä—ã</h5>
        <div class="row justify-content-center">
            <div class="col-md-3">
                <input type="text" class="form-control"
                       th:placeholder="#{gallery.searchPlaceholder}" />
            </div>
            <div class="col-md-3">
                <select class="form-select">
                    <option th:text="#{gallery.filter.all}">–í—Å–µ</option>
                    <option th:text="#{gallery.filter.withRelative}">–°–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º</option>
                    <option th:text="#{gallery.filter.withoutRelative}">–ë–µ–∑ —Å–≤—è–∑–µ–π</option>
                </select>
            </div>
        </div>
    </div>
</div>


<!--<script th:inline="javascript">-->
<!--    const username = /*[[${#authentication.name}]]*/ '';-->
<!--    function getPhotoUrl(filename) {-->
<!--        return `/uploads/${username}/${filename}`;-->
<!--    }-->
<!--</script>-->


<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
    <div id="toastContainer" class="toast text-white bg-success" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body" th:text="#{gallery.grid.toastDeleted}">–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ</div>
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div th:replace="~{fragments/upload_modal :: uploadModal}"></div>
<div th:replace="~{fragments/delete_modal :: deleteModal}"></div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/gallery_grid.js}"></script>

</body>
</html>
